<html>
    <head>
        <meta charset="UTF-8">
        <title>CRUD BOOK</title>
        <link rel="stylesheet" href="../CSS/style_books.css">
    </head>
    <body>
        <div class="container">
            <h1 style="align-content: center;">LOAD BOOKS</h1>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Author</th>
                        <th>Unit Price</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <button onclick="updateBook('', '', '', '')">Update</button>
                        <button onclick="deleteBook('key')">Delete</button>
                    </td>
                </tbody>
            </table>
        </div>

        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
            import {
              getDatabase,
              ref,
              child,
              get,
              set,
              update,
              remove,
              onValue,
            } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";
      
            const firebaseConfig = {
              apiKey: "AIzaSyALP0s0RbtbJ2glwArGQ1s_yQ9kwhGicpI",
              authDomain: "thestore-55f0f.firebaseapp.com",
              databaseURL: "https://thestore-55f0f-default-rtdb.firebaseio.com",
              projectId: "thestore-55f0f",
              storageBucket: "thestore-55f0f.appspot.com",
              messagingSenderId: "318647012345",
              appId: "1:318647012345:web:fc1ceaf122b8376eaa8b28",
              measurementId: "G-1XNCYRDHHN",
            };
      
            const app = initializeApp(firebaseConfig);
            const db = getDatabase();
            const bookRef = ref(db, "books/");
      
            onValue(bookRef, (snapshot) => {
                const data = snapshot.val();
                var htmlData = "";
                for (var key in data) {
                    var book = data[key];
                    var name = book.name;
                    var author = book.author;
                    var unitPrice = book.unitPrice;
                    htmlData += `
                    <tr>
                        <td>${name}</td>
                        <td>${author}</td>
                        <td>${unitPrice}</td>
                        <td>
                        <button onclick="updateBook('${key}', '${name}', '${author}', '${unitPrice}')">Update</button>
                        <button onclick="deleteBook('${key}')">Delete</button>
                        </td>
                    </tr>
                    `;
                }
                document.querySelector("tbody").innerHTML = htmlData;
                });

                function updateBook(key, name, author, unitPrice) {
                // Mở cửa sổ prompt để nhập giá trị mới cho cuốn sách
                const newName = prompt("Enter new name", name);
                const newAuthor = prompt("Enter new author", author);
                const newUnitPrice = prompt("Enter new unit price", unitPrice);

                // Nếu người dùng nhập giá trị mới, cập nhật dữ liệu trong Firebase
                if (newName !== null && newAuthor !== null && newUnitPrice !== null) {
                    const updates = {
                    ["/books/" + key]: {
                        name: newName,
                        author: newAuthor,
                        unitPrice: newUnitPrice,
                    },
                    };
                    update(ref(db), updates);
                }
                }

                function deleteBook(key) {
                // Xóa cuốn sách khỏi Firebase
                if (confirm("Are you sure you want to delete this book?")) {
                    remove(child(ref(db), "books/" + key));
                }
                }
          </script>
    </body>
</html>